<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>OGR2Layers</title>
<style>
 #map{width:100%;height:1024px;}
</style>
<script src="http://www.openlayers.org/api/2.13/OpenLayers.js"></script>
<script src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"></script> <script type="text/javascript">
function urlCheck(str) {
	var v = new RegExp();
	v.compile("^[A-Za-z]+://[A-Za-z0-9-_]+\.[A-Za-z0-9-_%&\?\/.=]+$");
	if (!v.test(str)) {
		return "<i>"+str+"</i>";
	}
		return "<a href="+str+" target:'_blank'>open url</a>";
};
var map, selectsControls
function init(){
	var option = {
		projection: new OpenLayers.Projection("EPSG:900913"),
		displayProjection: new OpenLayers.Projection("EPSG:4326")
	};
	map = new OpenLayers.Map('map', option);
	gphy = new OpenLayers.Layer.Google( "Google Physical", {type: google.maps.MapTypeId.TERRAIN} );
	map.addLayer(gphy);
	map.setBaseLayer(gphy);
	var ls= new OpenLayers.Control.LayerSwitcher(); 
	map.addControl(ls); 
	ls.maximizeControl(); 
	map.addControl(new OpenLayers.Control.MousePosition());
	map.addControl(new OpenLayers.Control.Scale());
	map.addControl(new OpenLayers.Control.OverviewMap());
	map.addControl(new OpenLayers.Control.PanZoomBar());
	map.addControl(new OpenLayers.Control.Navigation());
	var WDFW_fish_release_template = { 
		pointRadius: 2,
		strokeColor: "rgb(0,0,0)",
		strokeOpacity: 1.0,
		fillColor: "rgb(91,109,144)",
		fillOpacity: 1.0
	}
	var WDFW_fish_release_style = new OpenLayers.Style(WDFW_fish_release_template)
	//START QUERY WDFW_fish_release
	function onPopupCloseWDFW_fish_release(evt) {
		selectControl.unselect(selectedFeature);
	}
	function onFeatureSelectWDFW_fish_release(feature){
		selectedFeature = feature;
		tableWDFW_fish_release="<html><meta http-equiv='Content-Type' content='text/html; charset=UTF-8'><body><table>"
		tableWDFW_fish_release+="<tr><td><b>lat:</b></td><td>"+urlCheck(feature.attributes.lat)+"</td></tr>"
		tableWDFW_fish_release+="<tr><td><b>long:</b></td><td>"+urlCheck(feature.attributes.long)+"</td></tr>"
		tableWDFW_fish_release+="<tr><td><b>number:</b></td><td>"+urlCheck(feature.attributes.number)+"</td></tr>"
		tableWDFW_fish_release+="<tr><td><b>site:</b></td><td>"+urlCheck(feature.attributes.site)+"</td></tr>"
		tableWDFW_fish_release+="</table></body></html>"; 
		popup = new OpenLayers.Popup.FramedCloud("chicken", 
			feature.geometry.getBounds().getCenterLonLat(),
			new OpenLayers.Size(1000,500),
			tableWDFW_fish_release,
			null,
			true,
			onPopupCloseWDFW_fish_release
		); 
		feature.popup = popup;
		map.addPopup(popup);
	}
	function onFeatureUnselectWDFW_fish_release(feature) {
		map.removePopup(feature.popup);
		feature.popup.destroy();
		feature.popup = null;
	}
	//STOP QUERY WDFW_fish_release
	var WDFW_fish_release = new OpenLayers.Layer.Vector("WDFW_fish_release GeoJSON", {
		protocol: new OpenLayers.Protocol.HTTP({
			url: "WDFW_fish_release.GeoJSON",
			format: new OpenLayers.Format.GeoJSON()
		}),
		strategies: [
			new OpenLayers.Strategy.Fixed()
		],
		styleMap: WDFW_fish_release_style
	});
	map.addLayer(WDFW_fish_release);
	selectControl = new OpenLayers.Control.SelectFeature(
		[WDFW_fish_release, ],
		{
			clickout: true, toggle: false, 
			multiple: false, hover: false, 
			toggleKey: "ctrlKey", // ctrl key removes from selection
			multipleKey: "shiftKey" // shift key adds to selection
		}
	);
	map.addControl(selectControl);
	selectControl.activate();
	WDFW_fish_release.events.on({
		"featureselected": function(e) {
			onFeatureSelectWDFW_fish_release(e.feature);
		},
		"featureunselected": function(e) {
			onFeatureUnselectWDFW_fish_release(e.feature);
		}
	});
	extent = new OpenLayers.Bounds(-13959800.951,5900025.07901,-13313735.9541,6270323.80452).transform(new OpenLayers.Projection("EPSG:4326"), new OpenLayers.Projection("EPSG:900913"));
	map.zoomToExtent(extent);
};
</script>
</head>
<body onload="init()">
<h1>Release sites</h1>
<div id="map"></div>
</body>
</html>
